const app=new Vue({el:"#app",data:{popupType:null,popupTitle:window.popupSuccessTitle,isPopupActive:!1,isActiveRequest:!1,formOptions:{websiteLink:null,isLandUnique:!1,isDefaultDownload:!1,isSaveStructure:!1},downloadedFiles:0,apiUrl:"https://copier.shafshafa.com"},methods:{download(e,t){const i=document.createElement("a");i.setAttribute("href",t),i.setAttribute("download",e),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)},checkProgress(e){const t=new XMLHttpRequest,i=`${this.apiUrl}/api/getStatus/${e}`;t.open("GET",i,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=()=>{if(4===t.readyState&&200===t.status){const i=JSON.parse(t.response),s=setInterval((()=>{this.downloadedFiles<i.copiedFilesAmount?this.downloadedFiles+=1:clearInterval(s)}),10);i.isFinished?i.isFinished&&i.success?(this.download("shafshafa.zip",`${this.apiUrl}/api/downloadArchive/${e}`),gtag("event","download-webpage",{url:""}),this.popupTitle=window.popupSuccessTitle,this.popupType="تم الشفشفة بنجااح !",this.isPopupActive=!0,this.isActiveRequest=!1,this.downloadedFiles=i.copiedFilesAmount):i.isFinished&&!i.success&&(this.popupTitle=`${window.popupDeclineTitle} ${window.errors[i.errorText]||""}`,this.popupType="downloadDecline",this.isPopupActive=!0,this.isActiveRequest=!1,this.downloadedFiles=0):setTimeout((()=>{this.checkProgress(i.md5)}),1500)}else if(4===t.readyState&&200!==t.status){const e=JSON.parse(t.response);this.popupTitle=`${window.popupDeclineTitle} ${window.errors[e.errorText]||""}`,this.popupType="downloadDecline",this.isPopupActive=!0,this.isActiveRequest=!1,this.downloadedFiles=0}},t.send(null)},submitForm(e){e.preventDefault();const t=new XMLHttpRequest,i=`${this.apiUrl}/api/copySite`;t.open("POST",i,!0),t.setRequestHeader("Content-type","application/json");const s=JSON.stringify({url:this.formOptions.websiteLink,renameAssets:this.formOptions.isLandUnique,saveStructure:this.formOptions.isSaveStructure,alternativeAlgorithm:this.formOptions.isDefaultDownload});t.onreadystatechange=()=>{if(4===t.readyState&&200===t.status){const e=JSON.parse(t.response);e.isFinished&&!e.success?(this.popupTitle=`${window.popupDeclineTitle} ${window.errors[e.errorText]||""}`,this.popupType="downloadDecline",this.isPopupActive=!0,this.isActiveRequest=!1):this.checkProgress(e.md5)}else if(4===t.readyState&&200!==t.status){const e=JSON.parse(t.response);this.popupTitle=`${window.popupDeclineTitle} ${window.errors[e.errorText]||""}`,this.popupType="downloadDecline",this.isPopupActive=!0,this.isActiveRequest=!1}},t.send(s),this.downloadedFiles=0,this.isActiveRequest=!0},successFormPopup(e){e.preventDefault(),this.isPopupActive=!1},declineFormPopup(e){e.preventDefault(),this.isPopupActive=!1},closePopup(e){e.preventDefault(),this.isPopupActive=!1},isUrlValid:e=>/^https?:\/\/.*/g.test(e),isOnionDomain:e=>/.onion$|.onion\//g.test(e),onChangeUrl(e){!this.isUrlValid(this.formOptions.websiteLink)||0===this.formOptions.websiteLink.length||this.isOnionDomain(this.formOptions.websiteLink)?e.target.setCustomValidity(window.incorrectLink):e.target.setCustomValidity("")},onChangeLang(e){const t=window.location.href,i=e.target.value,s=t.substring(0,t.length-2);window.location.href=s+i}}});